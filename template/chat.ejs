<% layout('layout/page') -%>
<% block('title', "Node-Chat") -%>

<script src="/socket.io/socket.io.js"></script>

<p class="lead">Chat will be here.</p>

<p>Welcome, <%= user.get('username') %></p>


<div id="room">
  <ul id="chat" class="list-unstyled"></ul>
  <form>
    <input class="form-control" autocomplete="off" autofocus placeholder="Message...">
  </form>
</div>

<script>
  var socket = io.connect();

  var form = $('#room form');
  var ul = $('#room ul');

  form.submit(function() {
    var input = $(this).find(':input');
    var text = $('.form-control').val()
    input.val('');

    socket.emit('message', text, function(data){
      console.log(data);
      $('<li>', {text: text}).appendTo(ul);
    });
    
    return false;
  });

  socket.on('message', function(text) {
    $('<li>', {text: text}).appendTo(ul);
  });
</script>
